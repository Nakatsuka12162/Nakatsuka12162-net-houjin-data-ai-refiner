{% extends 'admin/base.html' %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2><i class="fas fa-history"></i> Change History ({{ history.paginator.count }})</h2>
    </div>
    <div class="card-body">
        <form method="get" class="search-bar" data-no-loading>
            <input type="text" name="search" placeholder="Search history..." value="{{ search }}">
            <button type="submit" class="btn btn-primary"><i class="fas fa-search"></i> Search</button>
        </form>
        
        <div class="table-wrapper">
            <table class="table">
                <thead>
                    <tr>
                        <th>Timestamp</th>
                        <th>Corporate Number</th>
                        <th>Field Changed</th>
                        <th>Change</th>
                    </tr>
                </thead>
                <tbody>
                    {% for change in history %}
                    <tr>
                        <td style="white-space: nowrap;">
                            <span style="color: #0891b2;">
                                <i class="fas fa-clock"></i> {{ change.timestamp|date:"Y-m-d H:i" }}
                            </span>
                        </td>
                        <td>
                            <code style="background: #f3f4f6; padding: 0.125rem 0.375rem; border-radius: 4px;">
                                {{ change.corporate_number }}
                            </code>
                        </td>
                        <td>
                            <span class="badge badge-primary">{{ change.changed_field }}</span>
                        </td>
                        <td>
                            <div style="display: flex; align-items: center; gap: 0.375rem; flex-wrap: wrap;">
                                {% if change.old_value %}
                                    <span style="color: #dc2626; background: #fee2e2; padding: 0.125rem 0.375rem; border-radius: 4px; font-size: 0.8125rem;">
                                        {{ change.old_value|truncatechars:30 }}
                                    </span>
                                {% else %}
                                    <span style="color: #9ca3af;">-</span>
                                {% endif %}
                                <span style="color: #9ca3af;"><i class="fas fa-arrow-right"></i></span>
                                {% if change.new_value %}
                                    <span style="color: #059669; background: #d1fae5; padding: 0.125rem 0.375rem; border-radius: 4px; font-size: 0.8125rem;">
                                        {{ change.new_value|truncatechars:30 }}
                                    </span>
                                {% else %}
                                    <span style="color: #9ca3af;">-</span>
                                {% endif %}
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="4" style="text-align: center; padding: 2rem; color: #9ca3af;">
                            <div style="font-size: 2rem; margin-bottom: 0.5rem;"><i class="fas fa-clipboard"></i></div>
                            <div>No history records found.</div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        {% if history.has_other_pages %}
        <div class="pagination">
            {% if history.has_previous %}
                <a href="?page=1{% if search %}&search={{ search }}{% endif %}" data-no-loading>&laquo; First</a>
                <a href="?page={{ history.previous_page_number }}{% if search %}&search={{ search }}{% endif %}" data-no-loading>&lsaquo; Prev</a>
            {% endif %}
            
            <span class="current">{{ history.number }} / {{ history.paginator.num_pages }}</span>
            
            {% if history.has_next %}
                <a href="?page={{ history.next_page_number }}{% if search %}&search={{ search }}{% endif %}" data-no-loading>Next &rsaquo;</a>
                <a href="?page={{ history.paginator.num_pages }}{% if search %}&search={{ search }}{% endif %}" data-no-loading>Last &raquo;</a>
            {% endif %}
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
